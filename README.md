# Предсказание продаж книг
Мое решение заняло 18 место (**top 2%**) в [соревновании на Kaggle](https://www.kaggle.com/competitions/tabular-playground-series-sep-2022)

Public score: **4.22260**

Private score: **4.95568**

## Задача
На основе данных за 4 года (2017-2020) предсказать количество продаж книг в 2021 году.

## Метрика
В качестве метрики выступает [SMAPE](https://en.wikipedia.org/wiki/Symmetric_mean_absolute_percentage_error):

![image](https://user-images.githubusercontent.com/24645573/195233083-f3618153-4dec-4548-b00f-bad05e403b1b.png)

## Данные
`train.csv` - данные задачи за 2017-2020

`test.csv` - данные задачи за 2021 года которые нужно предсказать

## Решение
[**book-sales-time-series.ipynb**](https://github.com/Pomiro/book-sales-time-series/blob/main/book-sales-time-series.ipynb) - EDA и базовое решение

[**final_sub.ipynb**](https://github.com/Pomiro/book-sales-time-series/blob/main/final_sub.ipynb) - финальное решение

### Fast EDA
- У нас три категориальные переменные: Страна, Магазин и Продукт
- Данные разделены равномерно, так что в каждой стране есть каждый магазин с каждым товаром
- Нам предоставлены данные за 2017-2020 года
- Данные в 2020 году сильно различаются от предыдущих годов, в связи с Covid-19
- У каждого продукта свой паттерн(тренд, сезонность и т.п.) продаж, между странами и магазинами паттерн сохраняется
### Удаление данных и предсказание новых
![image](https://user-images.githubusercontent.com/24645573/195237590-291b1f14-d7fd-43e1-b0a8-1dcc50777699.png)
> Я удалил выбросы данных за первую половину 2020 года и предсказал, на основе предыдущих годов, какие бы здесь были продажи, не будь ковида.
> Модель - Ridge Regression

![image](https://user-images.githubusercontent.com/24645573/195238830-bccc95f2-6385-4207-8afd-601836c348dd.png)

## Модель
Нам потребуется 2 прогноза:
- Общий прогноз продаж
- Прогноз соотношения продаж к продукции

### Общий прогноз продаж
Данные объединяются по странам, магазинам и продукции. И с помощю [Ridge](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html) из sklearn предсказываются продажи за 2021 год.

### Прогноз соотношения продаж к продукту
Теперь нам просто нужно взять соотношения продаж к продукту умножить его на общее количество продаж и мы получим количество продаж для каждого продукта. Чтобы предсказать соотношения продаж в 2021 году, я воспользовался моделью [catboost](https://catboost.ai/)
